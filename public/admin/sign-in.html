%# --- ARGS -------------------------------------------------------------------
<%args>
    $username => ''
    $password => ''
</%args>
%# --- INIT -------------------------------------------------------------------
<%init>
    my $error;

    # if this person is already logged in, they don't need any of this...
    if ( $SESS->{_signed_in} ) {
        $m->redirect('/admin/');
        return;
    }

    # check the username and password properly
    my $usr = $DBH->selectrow_hashref( "SELECT name, password FROM usr WHERE name = ? AND password = md5(? || ?)", undef, $username, $CFG->{salt}, $password );
    if ( defined $usr->{name} ) {
        WebApp::Session::signed_in( $SESS, $DBH );

        # signed in okay, so now redirect to a better page
        $m->redirect( '/admin/' );
        return;
    }
    else {
        $error = 'Username/Password not found';
    }
</%init>
%# --- HTML -------------------------------------------------------------------
<& form.mhtml, name => $username, error => $error &>
%# --- ATTRS ------------------------------------------------------------------
<%attr>
    access_required => 0
</%attr>
%# --- END --------------------------------------------------------------------
