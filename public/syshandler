%# --- ONCE -------------------------------------------------------------------
<%once>
    $CFG = {};
    Config::Simple->import_from('/etc/kiwiwriters/kiwiwriters.cfg', $CFG);
</%once>
%# --- INIT -------------------------------------------------------------------
<%init>
    # connect to the database
    $DBH = DBI->connect(
        "dbi:Pg:dbname=$CFG->{db_name}",
        $CFG->{db_user},
        undef,
        { RaiseError => 1, AutoCommit => 1 }
    );

    # wrap it all up in cookie/session handling
    WebApp::Session::begin( $SESS, $r, $DBH );

    $m->call_next();

    WebApp::Session::end( $SESS, $r, $DBH );
</%init>
%# --- FLAGS ------------------------------------------------------------------
<%flags>
    inherit => undef
</%flags>
%# --- END --------------------------------------------------------------------
